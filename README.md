# EduBrain AI - æ™ºèƒ½é¢˜åº“ç³»ç»Ÿ

> **é‡å¤§æ›´æ–°é€šçŸ¥**: æœ¬é¡¹ç›®å·²å‡çº§ä¸ºç¬¬ä¸‰æ–¹APIä»£ç†æ± æ¶æ„ï¼Œæ”¯æŒå¤šä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚é…ç½®ç»“æ„å·²ä»å•ä¸€APIé…ç½®å‡çº§ä¸ºä»£ç†æ± æ•°ç»„é…ç½®ï¼Œæä¾›æ›´é«˜çš„å¯é æ€§å’Œçµæ´»æ€§ã€‚

è¿™æ˜¯ä¸€ä¸ªåŸºäºPythonå’Œå¤šç¬¬ä¸‰æ–¹AI APIçš„æ–°ä¸€ä»£æ™ºèƒ½é¢˜åº“æœåŠ¡ï¼Œä¸“ä¸º[OCS (Online Course Script)](https://github.com/ocsjs/ocsjs)è®¾è®¡ï¼Œå¯ä»¥é€šè¿‡AIè‡ªåŠ¨å›ç­”é¢˜ç›®ã€‚æ­¤æœåŠ¡å®ç°äº†ä¸OCS AnswererWrapperå…¼å®¹çš„APIæ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·å°†AIèƒ½åŠ›æ•´åˆåˆ°OCSé¢˜åº“æœç´¢ä¸­ã€‚

## âš ï¸ é‡è¦æç¤º

> [!IMPORTANT]
> - æœ¬é¡¹ç›®ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¸ä¿è¯ç¨³å®šæ€§ï¼Œä¸”ä¸æä¾›ä»»ä½•æŠ€æœ¯æ”¯æŒã€‚
> - ä½¿ç”¨è€…å¿…é¡»åœ¨éµå¾ªå„ç¬¬ä¸‰æ–¹AIæœåŠ¡æä¾›å•†çš„ä½¿ç”¨æ¡æ¬¾ä»¥åŠ**æ³•å¾‹æ³•è§„**çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¸å¾—ç”¨äºéæ³•ç”¨é€”ã€‚
> - æ ¹æ®[ã€Šç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ç®¡ç†æš‚è¡ŒåŠæ³•ã€‹](http://www.cac.gov.cn/2023-07/13/c_1690898327029107.htm)çš„è¦æ±‚ï¼Œè¯·å‹¿å¯¹ä¸­å›½åœ°åŒºå…¬ä¼—æä¾›ä¸€åˆ‡æœªç»å¤‡æ¡ˆçš„ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ã€‚
> - ä½¿ç”¨è€…åº”å½“éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œæ‰¿æ‹…ç›¸åº”çš„æ³•å¾‹è´£ä»»
> - æœåŠ¡ä¸å¯¹AIç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§åšå‡ºä¿è¯

## ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹

- ğŸŒ **ç¬¬ä¸‰æ–¹APIä»£ç†æ± **ï¼šæ”¯æŒå¤šä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
- ğŸ’¡ **å¤šAIä¾›åº”å•†æ”¯æŒ**ï¼šæ”¯æŒOpenAIã€Anthropicã€Googleç­‰å¤šä¸ªAIä¾›åº”å•†
- ğŸ”„ **OCSå…¼å®¹**ï¼šå®Œå…¨å…¼å®¹OCSçš„AnswererWrapperé¢˜åº“æ¥å£
- ğŸš€ **é«˜æ€§èƒ½ç¼“å­˜**ï¼šRedis + å†…å­˜åŒé‡ç¼“å­˜ï¼Œå¿«é€Ÿå“åº”è¯·æ±‚
- ğŸ”’ **å®‰å…¨å¯é **ï¼šæ”¯æŒè®¿é—®ä»¤ç‰ŒéªŒè¯ï¼Œå®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†
- ğŸ’¬ **å¤šç§é¢˜å‹**ï¼šæ”¯æŒå•é€‰ã€å¤šé€‰ã€åˆ¤æ–­ã€å¡«ç©ºç­‰é¢˜å‹
- ğŸ“Š **æ•°æ®ç»Ÿè®¡**ï¼šå®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€å’Œä½¿ç”¨æƒ…å†µ
- ğŸŒ **Webç®¡ç†ç•Œé¢**ï¼šç°ä»£åŒ–çš„å“åº”å¼ç®¡ç†ä»ªè¡¨ç›˜
- ğŸ“± **ç§»åŠ¨å‹å¥½**ï¼šå®Œç¾é€‚é…æ‰‹æœºå’Œå¹³æ¿è®¾å¤‡
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**ï¼šå®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ç³»ç»Ÿ
- ğŸ”‘ **ä»£ç†æ± ç›‘æ§**ï¼šæ™ºèƒ½ä»£ç†é€‰æ‹©ã€å¯†é’¥è½®æ¢å’Œå®æ—¶ç›‘æ§
- ğŸ–¼ï¸ **å›¾ç‰‡ä»£ç†**ï¼šè§£å†³è¶…æ˜Ÿå¹³å°å›¾ç‰‡403é—®é¢˜
- ğŸ“š **é¢˜åº“ç®¡ç†**ï¼šå®Œæ•´çš„é¢˜åº“å¢åˆ æ”¹æŸ¥å’Œå¯¼å‡ºåŠŸèƒ½
- âš¡ **æ™ºèƒ½æ•…éšœè½¬ç§»**ï¼šè‡ªåŠ¨æ£€æµ‹ä»£ç†çŠ¶æ€ï¼Œæ— ç¼åˆ‡æ¢åˆ°å¯ç”¨ä»£ç†
- ğŸ¯ **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒå¤šç§ä»£ç†é€‰æ‹©ç­–ç•¥ï¼Œä¼˜åŒ–æ€§èƒ½å’Œå¯é æ€§

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+ (æ¨è Python 3.9+)
- MySQL 8.0+ (ç”¨äºæ•°æ®å­˜å‚¨)
- Redis (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
- ç¬¬ä¸‰æ–¹AI APIå¯†é’¥ï¼ˆæ”¯æŒOpenAIå…¼å®¹æ¥å£çš„æœåŠ¡ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»£ç åº“

```bash
git clone https://github.com/LynnGuo666/ocsjs-ai-answer-service.git
cd ocsjs-ai-answer-service
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# Windows æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate

# Linux/Mac æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate
```

### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 4. æ•°æ®åº“é…ç½®

ç¡®ä¿MySQLæœåŠ¡è¿è¡Œï¼Œå¹¶åˆ›å»ºæ•°æ®åº“ï¼š

```sql
CREATE DATABASE ocs_qa CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 5. é…ç½®config.json

å°†`config.json.example`å¤åˆ¶ä¸º`config.json`å¹¶å¡«å†™å¿…è¦çš„é…ç½®ä¿¡æ¯ï¼š

```bash
# Windows
copy config.json.example config.json

# Linux/Mac
cp config.json.example config.json
```

ç¼–è¾‘`config.json`æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’Œç¬¬ä¸‰æ–¹APIä»£ç†æ± ï¼š

```json
{
  "service": {
    "host": "0.0.0.0",
    "port": 5000,
    "debug": false
  },
  "database": {
    "type": "mysql",
    "host": "localhost",
    "port": 3306,
    "user": "root",
    "password": "your_db_password",
    "name": "ocs_qa"
  },
  "third_party_apis": [
    {
      "name": "ä¸»è¦APIæœåŠ¡",
      "api_base": "https://api.example.com",
      "api_keys": [
        "sk-your-api-key-1",
        "sk-your-api-key-2"
      ],
      "model": "claude-3-5-sonnet",
      "models": [
        "claude-3-5-sonnet",
        "gpt-4o-mini",
        "gemini-1.5-pro"
      ],
      "is_active": true,
      "priority": 1
    }
  ],
  "cache": {
    "enable": true,
    "expiration": 2592000
  },
  "security": {
    "access_token": "your_access_token_here"
  }
}
```

### 6. å¯åŠ¨æœåŠ¡

```bash
python app.py
```

æœåŠ¡å°†é»˜è®¤è¿è¡Œåœ¨`http://localhost:5000`

### 7. è®¿é—®Webç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5000` è¿›å…¥ç®¡ç†ç•Œé¢ã€‚é¦–æ¬¡ä½¿ç”¨éœ€è¦æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·ã€‚

### 8. åœ¨OCSä¸­é…ç½®ä½¿ç”¨

åœ¨OCSçš„è‡ªå®šä¹‰é¢˜åº“é…ç½®ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```json
[
  {
    "name": "AIæ™ºèƒ½é¢˜åº“",
    "url": "http://localhost:5000/api/search",
    "method": "get",
    "contentType": "json",
    "headers": {
      "X-Access-Token": "your_access_token_here"
    },
    "data": {
      "title": "${title}",
      "type": "${type}",
      "options": "${options}"
    },
    "handler": "return (res)=> res.code === 1 ? [res.question, res.answer] : [res.msg, undefined]"
  }
]
```

> **æ³¨æ„**: å¦‚æœé…ç½®äº†è®¿é—®ä»¤ç‰Œï¼Œéœ€è¦åœ¨headersä¸­æ·»åŠ `X-Access-Token`å­—æ®µã€‚

## ğŸ“š Webç®¡ç†ç•Œé¢

### ä¸»è¦åŠŸèƒ½é¡µé¢

- **ä»ªè¡¨ç›˜** (`/dashboard`): ç³»ç»ŸçŠ¶æ€ç›‘æ§å’Œé—®ç­”è®°å½•ç»Ÿè®¡
- **AIå®æ—¶æœé¢˜** (`/ai-search`): åœ¨çº¿æµ‹è¯•AIç­”é¢˜åŠŸèƒ½
- **é¢˜åº“ç®¡ç†** (`/questions`): é¢˜åº“å¢åˆ æ”¹æŸ¥å’Œæ•°æ®å¯¼å‡º
- **ç³»ç»Ÿæ—¥å¿—** (`/logs`): æŸ¥çœ‹å’Œç®¡ç†ç³»ç»Ÿæ—¥å¿—
- **ä»£ç†æ± ç›‘æ§** (`/proxy-monitor`): ç¬¬ä¸‰æ–¹APIä»£ç†æ± å®æ—¶ç›‘æ§å’Œç®¡ç†
- **ç³»ç»Ÿè®¾ç½®** (`/settings`): ä»£ç†æ± é…ç½®å’Œç³»ç»Ÿå‚æ•°ç®¡ç†

### ç”¨æˆ·æƒé™

- **æ™®é€šç”¨æˆ·**: å¯ä»¥æŸ¥çœ‹ä»ªè¡¨ç›˜å’Œä½¿ç”¨AIæœé¢˜åŠŸèƒ½
- **ç®¡ç†å‘˜**: æ‹¥æœ‰æ‰€æœ‰åŠŸèƒ½æƒé™ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿé…ç½®ç­‰

## ğŸ”Œ APIæ¥å£è¯´æ˜

### æ ¸å¿ƒæœç´¢æ¥å£

**URL**: `/api/search`

**æ–¹æ³•**: `GET` æˆ– `POST`

**è¯·æ±‚å¤´**:
```
X-Access-Token: your_access_token_here (å¯é€‰)
```

**å‚æ•°**:

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                     |
|---------|--------|------|----------------------------------------------------------|
| title   | string | æ˜¯   | é¢˜ç›®å†…å®¹                                                 |
| type    | string | å¦   | é¢˜ç›®ç±»å‹ (single-å•é€‰, multiple-å¤šé€‰, judgement-åˆ¤æ–­, completion-å¡«ç©º) |
| options | string | å¦   | é€‰é¡¹å†…å®¹ï¼Œé€šå¸¸æ˜¯Aã€Bã€Cã€Dé€‰é¡¹çš„æ–‡æœ¬                       |
| proxy   | string | å¦   | æŒ‡å®šä»£ç†æœåŠ¡åç§°                                         |
| model   | string | å¦   | æŒ‡å®šæ¨¡å‹åç§°                                             |

**æˆåŠŸå“åº”**:

```json
{
  "code": 1,
  "question": "é—®é¢˜å†…å®¹",
  "answer": "AIç”Ÿæˆçš„ç­”æ¡ˆ",
  "proxy": "ä¸»è¦APIæœåŠ¡",
  "model": "gpt-4o-mini",
  "cached": false,
  "response_time": 1.23
}
```

**å¤±è´¥å“åº”**:

```json
{
  "code": 0,
  "msg": "é”™è¯¯ä¿¡æ¯"
}
```

### ç³»ç»Ÿç›‘æ§æ¥å£

#### å¥åº·æ£€æŸ¥

**URL**: `/api/health`

**æ–¹æ³•**: `GET`

**å“åº”**:

```json
{
  "status": "ok",
  "message": "AIé¢˜åº“æœåŠ¡è¿è¡Œæ­£å¸¸",
  "version": "1.1.0",
  "cache_enabled": true,
  "model": "gpt-4o-mini"
}
```

#### ç¼“å­˜ç®¡ç†

**URL**: `/api/cache/clear`

**æ–¹æ³•**: `POST`

**å“åº”**:

```json
{
  "success": true,
  "message": "ç¼“å­˜å·²æ¸…é™¤",
  "cleared_count": 150
}
```

### é¢˜åº“ç®¡ç†æ¥å£

#### è·å–é¢˜åº“åˆ—è¡¨

**URL**: `/api/questions`

**æ–¹æ³•**: `GET`

**å‚æ•°**:
- `page`: é¡µç  (é»˜è®¤: 1)
- `per_page`: æ¯é¡µæ•°é‡ (é»˜è®¤: 20)
- `search`: æœç´¢å…³é”®è¯
- `type`: é¢˜ç›®ç±»å‹ç­›é€‰

#### å¯¼å‡ºé¢˜åº“

**URL**: `/api/questions/export`

**æ–¹æ³•**: `GET`

**å‚æ•°**:
- `format`: å¯¼å‡ºæ ¼å¼ (csv, json)
- `type`: é¢˜ç›®ç±»å‹ç­›é€‰

### å›¾ç‰‡ä»£ç†æ¥å£

**URL**: `/api/image/proxy`

**æ–¹æ³•**: `GET`

**å‚æ•°**:
- `url`: å›¾ç‰‡URL (éœ€è¦URLç¼–ç )

**è¯´æ˜**: ç”¨äºè§£å†³è¶…æ˜Ÿå¹³å°å›¾ç‰‡403é—®é¢˜

## ğŸŒ ç¬¬ä¸‰æ–¹APIä»£ç†æ± 

### ä»£ç†æ± æ¶æ„

æœ¬ç³»ç»Ÿé‡‡ç”¨å…ˆè¿›çš„ä»£ç†æ± æ¶æ„ï¼Œæ”¯æŒå¤šä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡çš„ç»Ÿä¸€ç®¡ç†ï¼š

- **è´Ÿè½½å‡è¡¡**: è‡ªåŠ¨åœ¨å¤šä¸ªä»£ç†é—´åˆ†é…è¯·æ±‚
- **æ•…éšœè½¬ç§»**: è‡ªåŠ¨æ£€æµ‹ä»£ç†çŠ¶æ€ï¼Œæ— ç¼åˆ‡æ¢åˆ°å¯ç”¨ä»£ç†
- **ä¼˜å…ˆçº§ç®¡ç†**: æ”¯æŒä»£ç†ä¼˜å…ˆçº§è®¾ç½®ï¼Œä¼˜å…ˆä½¿ç”¨é«˜ä¼˜å…ˆçº§ä»£ç†
- **å¯†é’¥è½®æ¢**: æ¯ä¸ªä»£ç†æ”¯æŒå¤šä¸ªAPIå¯†é’¥çš„æ™ºèƒ½è½®æ¢
- **å®æ—¶ç›‘æ§**: ä»£ç†æ± çŠ¶æ€å®æ—¶ç›‘æ§å’Œç»Ÿè®¡

### ä»£ç†æ± é…ç½®

åœ¨ `config.json` ä¸­é…ç½®ä»£ç†æ± ï¼š

```json
{
  "third_party_apis": [
    {
      "name": "ä¸»è¦APIæœåŠ¡",
      "api_base": "https://api.example.com",
      "api_keys": [
        "sk-key1",
        "sk-key2",
        "sk-key3"
      ],
      "model": "gpt-4o-mini",
      "models": [
        "gpt-4o-mini",
        "gpt-4o",
        "claude-3-sonnet"
      ],
      "is_active": true,
      "priority": 1
    },
    {
      "name": "å¤‡ç”¨APIæœåŠ¡",
      "api_base": "https://backup-api.example.com",
      "api_keys": [
        "sk-backup-key1",
        "sk-backup-key2"
      ],
      "model": "gpt-4o",
      "models": [
        "gpt-4o",
        "gpt-4o-mini"
      ],
      "is_active": true,
      "priority": 2
    }
  ]
}
```

### é…ç½®å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `name` | string | æ˜¯ | ä»£ç†æœåŠ¡åç§°ï¼Œç”¨äºæ ‡è¯†å’Œæ˜¾ç¤º |
| `api_base` | string | æ˜¯ | APIåŸºç¡€URLåœ°å€ |
| `api_keys` | array | æ˜¯ | APIå¯†é’¥æ•°ç»„ï¼Œæ”¯æŒå¤šä¸ªå¯†é’¥è½®æ¢ |
| `model` | string | æ˜¯ | é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹åç§° |
| `models` | array | æ˜¯ | æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨ |
| `is_active` | boolean | æ˜¯ | æ˜¯å¦æ¿€æ´»æ­¤ä»£ç†ï¼ˆtrue/falseï¼‰ |
| `priority` | number | æ˜¯ | ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ |

### ä»£ç†é€‰æ‹©ç­–ç•¥

ç³»ç»Ÿæ”¯æŒå¤šç§ä»£ç†é€‰æ‹©ç­–ç•¥ï¼š

1. **ä¼˜å…ˆçº§ç­–ç•¥**: ä¼˜å…ˆä½¿ç”¨priorityå€¼æœ€å°çš„æ¿€æ´»ä»£ç†
2. **éšæœºç­–ç•¥**: ä»æ¿€æ´»ä»£ç†ä¸­éšæœºé€‰æ‹©ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
3. **æ¨¡å‹åŒ¹é…**: æ ¹æ®è¯·æ±‚çš„æ¨¡å‹è‡ªåŠ¨é€‰æ‹©æ”¯æŒè¯¥æ¨¡å‹çš„ä»£ç†
4. **æ•…éšœè½¬ç§»**: å½“å‰ä»£ç†å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨ä»£ç†

### ä»£ç†æ± ç›‘æ§

è®¿é—® `/proxy-monitor` é¡µé¢å¯ä»¥å®æ—¶ç›‘æ§ä»£ç†æ± çŠ¶æ€ï¼š

- **ä»£ç†æ± æ±‡æ€»**: æ€»ä»£ç†æ•°ã€æ¿€æ´»ä»£ç†æ•°ã€æ€»å¯†é’¥æ•°ã€æ”¯æŒæ¨¡å‹æ•°
- **ä»£ç†è¯¦æƒ…**: æ¯ä¸ªä»£ç†çš„çŠ¶æ€ã€ä¼˜å…ˆçº§ã€å¯†é’¥æ•°é‡ã€æ¨¡å‹æ”¯æŒ
- **å®æ—¶åˆ·æ–°**: æ”¯æŒè‡ªåŠ¨åˆ·æ–°å’Œæ‰‹åŠ¨åˆ·æ–°
- **å¯†é’¥ç®¡ç†**: æŸ¥çœ‹æ¯ä¸ªä»£ç†çš„å¯†é’¥åˆ—è¡¨å’Œå½“å‰ä½¿ç”¨çš„å¯†é’¥

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### ä½¿ç”¨Gunicornéƒ¨ç½²

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨Gunicornä½œä¸ºWSGIæœåŠ¡å™¨ï¼š

```bash
# åŸºæœ¬éƒ¨ç½²
gunicorn -w 4 -b 0.0.0.0:5000 app:app

# æ¨èçš„ç”Ÿäº§é…ç½®
gunicorn -w 4 -b 0.0.0.0:5000 \
  --timeout 120 \
  --keep-alive 2 \
  --max-requests 1000 \
  --max-requests-jitter 100 \
  --access-logfile logs/access.log \
  --error-logfile logs/error.log \
  app:app
```

#### ä½¿ç”¨Dockeréƒ¨ç½²

åˆ›å»º `Dockerfile`:

```Dockerfile
FROM python:3.9-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    gcc \
    default-libmysqlclient-dev \
    pkg-config \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# åˆ›å»ºæ—¥å¿—ç›®å½•
RUN mkdir -p logs

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "--timeout", "120", "app:app"]
```

æ„å»ºå¹¶è¿è¡ŒDockerå®¹å™¨ï¼š

```bash
# æ„å»ºé•œåƒ
docker build -t edubrain-ai .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name edubrain-ai \
  -p 5000:5000 \
  -v $(pwd)/config.json:/app/config.json \
  -v $(pwd)/logs:/app/logs \
  edubrain-ai
```

#### ä½¿ç”¨Docker Compose

åˆ›å»º `docker-compose.yml`:

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "5000:5000"
    volumes:
      - ./config.json:/app/config.json
      - ./logs:/app/logs
    depends_on:
      - mysql
      - redis
    environment:
      - FLASK_ENV=production

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: your_password
      MYSQL_DATABASE: ocs_qa
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
docker-compose up -d
```

## â“ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥é—®é¢˜

**é—®é¢˜**: å¯åŠ¨æ—¶å‡ºç°æ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ³•**:
- ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥config.jsonä¸­çš„æ•°æ®åº“é…ç½®
- ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æƒé™
- åˆ›å»ºæ•°æ®åº“ï¼š`CREATE DATABASE ocs_qa CHARACTER SET utf8mb4;`

### 2. ç¬¬ä¸‰æ–¹APIè¿æ¥é”™è¯¯

**é—®é¢˜**: é‡åˆ° `APIConnectionError` æˆ– `APIè°ƒç”¨å¤±è´¥`

**å¯èƒ½åŸå› **:
- APIå¯†é’¥æ— æ•ˆæˆ–è¿‡æœŸ
- APIåŸºç¡€URLé…ç½®é”™è¯¯
- ç½‘ç»œè¿æ¥é—®é¢˜
- APIé…é¢ä¸è¶³
- ä»£ç†æœåŠ¡ä¸å¯ç”¨

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥config.jsonä¸­çš„third_party_apisé…ç½®
- ç¡®è®¤APIå¯†é’¥æœ‰æ•ˆæ€§
- æµ‹è¯•ç½‘ç»œè¿æ¥
- æ£€æŸ¥APIä½¿ç”¨é…é¢
- è®¿é—® `/proxy-monitor` æŸ¥çœ‹ä»£ç†æ± çŠ¶æ€
- æ£€æŸ¥ä»£ç†çš„ `is_active` çŠ¶æ€

### 3. è™šæ‹Ÿç¯å¢ƒé—®é¢˜

**é—®é¢˜**: ä¾èµ–å®‰è£…å¤±è´¥æˆ–æ¨¡å—å¯¼å…¥é”™è¯¯

**è§£å†³æ–¹æ³•**:
```bash
# é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
rm -rf .venv  # Linux/Mac
rmdir /s .venv  # Windows

python -m venv .venv
.venv\Scripts\activate  # Windows
source .venv/bin/activate  # Linux/Mac

pip install --upgrade pip
pip install -r requirements.txt
```

### 4. æƒé™å’Œè®¤è¯é—®é¢˜

**é—®é¢˜**: æ— æ³•è®¿é—®ç®¡ç†åŠŸèƒ½

**è§£å†³æ–¹æ³•**:
- ç¡®ä¿å·²æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·
- æ£€æŸ¥ç”¨æˆ·æƒé™è®¾ç½®
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒCookie
- æ£€æŸ¥è®¿é—®ä»¤ç‰Œé…ç½®

### 5. AIç­”æ¡ˆå‡†ç¡®æ€§

**æ³¨æ„äº‹é¡¹**:
- AIç­”æ¡ˆä»…ä¾›å‚è€ƒï¼Œä¸ä¿è¯100%å‡†ç¡®
- å»ºè®®ä¸åŸé¢˜é€‰é¡¹å¯¹ç…§éªŒè¯
- å¤æ‚é¢˜ç›®å¯èƒ½éœ€è¦äººå·¥åˆ¤æ–­
- å¤šé€‰é¢˜æ ¼å¼å·²è‡ªåŠ¨å¤„ç†ä¸º`A#B#C`æ ¼å¼

### 6. æ€§èƒ½ä¼˜åŒ–

**ç¼“å­˜é…ç½®**:
- å¯ç”¨Redisç¼“å­˜æå‡æ€§èƒ½
- è°ƒæ•´ç¼“å­˜è¿‡æœŸæ—¶é—´
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜

**æ•°æ®åº“ä¼˜åŒ–**:
- å®šæœŸæ¸…ç†å†å²è®°å½•
- æ·»åŠ é€‚å½“çš„æ•°æ®åº“ç´¢å¼•
- ç›‘æ§æ•°æ®åº“æ€§èƒ½

### 7. ä»£ç†æ± é…ç½®é—®é¢˜

**é—®é¢˜**: ä»£ç†æ± æ— æ³•æ­£å¸¸å·¥ä½œæˆ–æ˜¾ç¤ºå¼‚å¸¸

**å¯èƒ½åŸå› **:
- é…ç½®æ ¼å¼é”™è¯¯
- ä»£ç†æœåŠ¡ä¸å¯ç”¨
- å¯†é’¥é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ `config.json` ä¸­ `third_party_apis` æ•°ç»„æ ¼å¼
- ç¡®ä¿æ¯ä¸ªä»£ç†éƒ½æœ‰å¿…å¡«å­—æ®µï¼š`name`, `api_base`, `api_keys`, `model`, `models`, `is_active`, `priority`
- è®¿é—® `/proxy-monitor` æŸ¥çœ‹ä»£ç†æ± å®æ—¶çŠ¶æ€
- æ£€æŸ¥ä»£ç†æœåŠ¡çš„ç½‘ç»œè¿æ¥
- éªŒè¯APIå¯†é’¥çš„æœ‰æ•ˆæ€§

**é…ç½®æ£€æŸ¥æ¸…å•**:
```json
{
  "third_party_apis": [
    {
      "name": "å¿…å¡«ï¼šä»£ç†åç§°",
      "api_base": "å¿…å¡«ï¼šAPIåŸºç¡€URL",
      "api_keys": ["å¿…å¡«ï¼šè‡³å°‘ä¸€ä¸ªAPIå¯†é’¥"],
      "model": "å¿…å¡«ï¼šé»˜è®¤æ¨¡å‹",
      "models": ["å¿…å¡«ï¼šæ”¯æŒçš„æ¨¡å‹åˆ—è¡¨"],
      "is_active": true,
      "priority": 1
    }
  ]
}
```

### 8. å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜

**é—®é¢˜**: è¶…æ˜Ÿå¹³å°å›¾ç‰‡æ— æ³•æ˜¾ç¤º

**è§£å†³æ–¹æ³•**:
- å›¾ç‰‡ä»£ç†æœåŠ¡å·²è‡ªåŠ¨å¤„ç†
- ç¡®ä¿ `/api/image/proxy` æ¥å£æ­£å¸¸
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

## ğŸ“ é¡¹ç›®ç»“æ„

```
ocsjs-ai-answer-service/
â”œâ”€â”€ config/                    # é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py             # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ api_proxy_pool.py     # ç¬¬ä¸‰æ–¹APIä»£ç†æ± ç®¡ç†
â”‚   â””â”€â”€ api_pool.py           # å‘åå…¼å®¹çš„APIæ± ç®¡ç†
â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ models.py            # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”œâ”€â”€ routes/                   # è·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py              # ç”¨æˆ·è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ questions.py         # é¢˜åº“ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ logs.py              # æ—¥å¿—ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ proxy_pool.py        # ä»£ç†æ± ç›‘æ§è·¯ç”±
â”‚   â”œâ”€â”€ settings.py          # è®¾ç½®ç®¡ç†è·¯ç”±
â”‚   â””â”€â”€ image_proxy.py       # å›¾ç‰‡ä»£ç†è·¯ç”±
â”œâ”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ model_service.py     # AIæ¨¡å‹æœåŠ¡
â”‚   â”œâ”€â”€ cache.py             # ç¼“å­˜æœåŠ¡
â”‚   â””â”€â”€ key_switcher.py      # å¯†é’¥ç®¡ç†æœåŠ¡
â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ utils.py             # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ auth.py              # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ logger.py            # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ question_cleaner.py  # é¢˜ç›®æ¸…ç†å·¥å…·
â”‚   â”œâ”€â”€ get_models_list.py   # æ¨¡å‹åˆ—è¡¨è·å–å·¥å…·
â”‚   â””â”€â”€ clean_question_prefixes.py  # é¢˜ç›®å‰ç¼€æ¸…ç†å·¥å…·
â”œâ”€â”€ static/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/                  # JavaScriptæ–‡ä»¶
â”‚   â””â”€â”€ img/                 # å›¾ç‰‡èµ„æº
â”œâ”€â”€ templates/               # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ base.html            # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ dashboard.html       # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ login.html           # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ questions.html       # é¢˜åº“ç®¡ç†
â”‚   â”œâ”€â”€ logs.html            # æ—¥å¿—æŸ¥çœ‹
â”‚   â”œâ”€â”€ proxy_pool.html      # ä»£ç†æ± ç›‘æ§
â”‚   â”œâ”€â”€ settings.html        # ç³»ç»Ÿè®¾ç½®
â”‚   â””â”€â”€ ...                  # å…¶ä»–æ¨¡æ¿
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•
â”œâ”€â”€ backups/                 # å¤‡ä»½ç›®å½•
â”œâ”€â”€ .venv/                   # è™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
â”œâ”€â”€ app.py                   # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ config.json              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.json.example      # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ config_example_multi_proxy.json  # å¤šä»£ç†é…ç½®ç¤ºä¾‹
â”œâ”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .gitignore              # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

## ğŸ”§ é…ç½®è¯´æ˜

### å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "service": {
    "host": "0.0.0.0",
    "port": 5000,
    "debug": false
  },
  "database": {
    "type": "mysql",
    "host": "localhost",
    "port": 3306,
    "user": "root",
    "password": "your_password",
    "name": "ocs_qa"
  },
  "redis": {
    "enabled": true,
    "host": "localhost",
    "port": 6379,
    "password": "",
    "db": 0
  },
  "third_party_apis": [
    {
      "name": "ä¸»è¦APIæœåŠ¡",
      "api_base": "https://api.example.com",
      "api_keys": [
        "sk-key1",
        "sk-key2",
        "sk-key3"
      ],
      "model": "gpt-4o-mini",
      "models": [
        "gpt-4o-mini",
        "gpt-4o",
        "claude-3-sonnet"
      ],
      "is_active": true,
      "priority": 1
    },
    {
      "name": "å¤‡ç”¨APIæœåŠ¡",
      "api_base": "https://backup-api.example.com",
      "api_keys": [
        "sk-backup-key1"
      ],
      "model": "gpt-4o",
      "models": [
        "gpt-4o",
        "gpt-4o-mini"
      ],
      "is_active": true,
      "priority": 2
    }
  ],
  "cache": {
    "enable": true,
    "expiration": 2592000
  },
  "security": {
    "access_token": "your_secure_token",
    "secret_key": "your_secret_key"
  },
  "logging": {
    "level": "INFO"
  },
  "record": {
    "enable": true
  },
  "response": {
    "max_tokens": 500,
    "temperature": 0.7
  },
  "default_provider": "third_party_api_pool"
}
```

## ğŸ”§ ä»£ç†æ± ç®¡ç†

### ä»£ç†æ± å¥åº·æ£€æŸ¥

ç³»ç»Ÿæä¾›äº†ä»£ç†æ± çš„å¥åº·æ£€æŸ¥å’Œç›‘æ§åŠŸèƒ½ï¼š

- **å®æ—¶ç›‘æ§**: è®¿é—® `/proxy-monitor` æŸ¥çœ‹ä»£ç†æ± å®æ—¶çŠ¶æ€
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**: ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ä»£ç†çŠ¶æ€ï¼Œå¤±è´¥æ—¶åˆ‡æ¢åˆ°å¤‡ç”¨ä»£ç†
- **è´Ÿè½½å‡è¡¡**: æ”¯æŒå¤šç§ä»£ç†é€‰æ‹©ç­–ç•¥ï¼Œä¼˜åŒ–æ€§èƒ½

### ä»£ç†æ± APIæ¥å£

```bash
# è·å–ä»£ç†æ± çŠ¶æ€
curl http://localhost:5000/api/key_pool

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
curl -X POST http://localhost:5000/api/cache/clear_all
```

### ä»£ç†æ± é…ç½®éªŒè¯

å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ä»£ç†æ± é…ç½®ï¼š

1. **Webç•Œé¢**: è®¿é—® `/proxy-monitor` æŸ¥çœ‹é…ç½®çŠ¶æ€
2. **APIæ¥å£**: è°ƒç”¨ `/api/key_pool` è·å–è¯¦ç»†ä¿¡æ¯
3. **æ—¥å¿—æ£€æŸ¥**: æŸ¥çœ‹ `/logs` é¡µé¢çš„ç³»ç»Ÿæ—¥å¿—

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚

## ğŸ™ è‡´è°¢

- [OCS (Online Course Script)](https://github.com/ocsjs/ocsjs) - æä¾›é¢˜åº“æ¥å£æ ‡å‡†
- [OpenAI](https://openai.com/) - æä¾›å¼ºå¤§çš„AIæ¨¡å‹
- [Flask](https://flask.palletsprojects.com/) - ä¼˜ç§€çš„Python Webæ¡†æ¶

---

**âš ï¸ å…è´£å£°æ˜**: æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œä½¿ç”¨è€…éœ€è‡ªè¡Œæ‰¿æ‹…ä½¿ç”¨é£é™©ï¼Œå¼€å‘è€…ä¸å¯¹ä»»ä½•åæœè´Ÿè´£ã€‚