{% extends 'base.html' %}
{% block title %}EduBrain AI - API文档{% endblock %}

{% block head %}
<style>
    /* 现代化API文档页面样式 */
    .docs-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .docs-card {
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: none;
        overflow: hidden;
        transition: all 0.3s ease;
        margin-bottom: 2rem;
    }
    
    .docs-card:hover {
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .docs-card .card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: none;
    }
    
    .docs-card .card-body {
        padding: 1.5rem 2rem;
    }
    
    /* 接口分类导航 */
    .api-nav {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    
    .api-nav .nav-pills .nav-link {
        border-radius: 8px;
        padding: 0.6rem 1.2rem;
        margin-right: 0.5rem;
        color: #495057;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .api-nav .nav-pills .nav-link:hover {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }
    
    .api-nav .nav-pills .nav-link.active {
        background-color: #0d6efd;
        color: white;
        box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3);
    }
    
    /* 接口部分样式 */
    .api-section {
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-radius: 12px;
        background-color: #fff;
        box-shadow: 0 2px 15px rgba(0,0,0,0.05);
    }
    
    .api-section h3 {
        color: #0d6efd;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #e9ecef;
    }
    
    .api-section h4 {
        color: #212529;
        font-weight: 600;
        margin-top: 1.5rem;
        margin-bottom: 1rem;
    }
    
    /* 接口端点样式 */
    .endpoint {
        display: flex;
        align-items: center;
        background-color: #f8f9fa;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    }
    
    .method {
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: bold;
        margin-right: 0.5rem;
        text-transform: uppercase;
    }
    
    .method-get {
        background-color: #0dcaf0;
        color: white;
    }
    
    .method-post {
        background-color: #198754;
        color: white;
    }
    
    .method-put {
        background-color: #ffc107;
        color: #212529;
    }
    
    .method-delete {
        background-color: #dc3545;
        color: white;
    }
    
    /* 表格样式 */
    .table {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-bottom: 1.5rem;
    }
    
    .table thead {
        background-color: #f8f9fa;
    }
    
    .table th {
        font-weight: 600;
        color: #495057;
    }
    
    /* 代码块样式 */
    pre {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        overflow-x: auto;
        box-shadow: inset 0 0 0 1px #e9ecef;
    }
    
    pre code {
        color: #212529;
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 0.9rem;
    }
    
    /* 提示框样式 */
    .alert-docs {
        background-color: #cff4fc;
        border-left: 4px solid #0dcaf0;
        color: #055160;
        padding: 1rem 1.25rem;
        margin-bottom: 1.5rem;
        border-radius: 8px;
    }
    
    /* 滚动到顶部按钮 */
    .scroll-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #0d6efd;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        cursor: pointer;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
    }
    
    .scroll-top.show {
        opacity: 1;
        visibility: visible;
    }
    
    .scroll-top:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.25);
    }
</style>
{% endblock %}

{% block content %}
<div class="container docs-container mt-5">
    <div class="docs-card">
        <div class="card-header bg-primary text-white">
            <h4 class="card-title mb-0"><i class="bi bi-book me-2"></i>EduBrain AI 题库服务 API文档</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-docs">
                <i class="bi bi-info-circle-fill me-2"></i>
                <strong>配置系统更新通知:</strong> 本项目已从环境变量配置(.env)迁移到JSON配置文件。请使用config.json来配置服务，不再需要.env文件。详细配置选项请参考config.json.example。
            </div>

            <div class="overview-section mb-4">
                <h3 class="mb-3"><i class="bi bi-info-circle me-2"></i>概述</h3>
                <div class="p-3 bg-light rounded-3">
                    <p class="mb-0">EduBrain AI题库服务是一个基于OpenAI API的问题解答服务，专为<a href="https://github.com/ocsjs/ocsjs" target="_blank" class="text-decoration-none">OCS (Online Course Script) <i class="bi bi-box-arrow-up-right small"></i></a>设计，可以通过AI自动回答题目。此服务实现了与OCS AnswererWrapper兼容的API接口，方便用户将AI能力整合到OCS题库搜索中。</p>
                </div>
            </div>

            <h3 class="mb-4"><i class="bi bi-list-check me-2"></i>接口详情</h3>

            <!-- 目录导航 -->
            <div class="api-nav mb-4">
                <h5 class="mb-3"><i class="bi bi-bookmark me-2"></i>接口分类</h5>
                <ul class="nav nav-pills" id="apiTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="core-tab" data-bs-toggle="pill" href="#core-api" role="tab" aria-controls="core-api" aria-selected="true">
                            <i class="bi bi-lightning-charge me-1"></i>核心功能
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="qa-tab" data-bs-toggle="pill" href="#qa-management" role="tab" aria-controls="qa-management" aria-selected="false">
                            <i class="bi bi-database me-1"></i>题库管理
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="system-tab" data-bs-toggle="pill" href="#system-api" role="tab" aria-controls="system-api" aria-selected="false">
                            <i class="bi bi-gear me-1"></i>系统功能
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="token-tab" data-bs-toggle="pill" href="#token-api" role="tab" aria-controls="token-api" aria-selected="false">
                            <i class="bi bi-key me-1"></i>Token管理
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- 核心功能接口 -->
            <div id="core-api" class="api-section tab-pane fade show active" role="tabpanel" aria-labelledby="core-tab">
                <h3><i class="bi bi-lightning-charge me-2"></i>核心功能接口</h3>
                
                <div class="api-item p-3 mb-4 border-start border-primary border-3 rounded-3 bg-light">
                    <h4 class="d-flex align-items-center">
                        <i class="bi bi-search me-2 text-primary"></i>搜索接口
                        <span class="ms-auto badge bg-primary rounded-pill">AI核心功能</span>
                    </h4>
                    
                    <div class="endpoint">
                        <span class="method method-get">GET</span>
                        <span class="method method-post">POST</span>
                        <strong>/api/search</strong>
                    </div>
                    
                    <div class="api-description mb-3">
                        <p><i class="bi bi-info-circle me-2"></i>用于接收OCS发送的问题并返回AI生成的答案。该接口是整个系统的核心功能。</p>
                    </div>
                    
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0 fs-6"><i class="bi bi-list-ul me-2"></i>请求参数</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>参数名</th>
                                            <th>类型</th>
                                            <th>必填</th>
                                            <th>说明</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>title</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-success">是</span></td>
                                            <td>题目内容</td>
                                        </tr>
                                        <tr>
                                            <td><code>type</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-warning text-dark">否</span></td>
                                            <td>题目类型 (single-单选, multiple-多选, judgement-判断, completion-填空)</td>
                                        </tr>
                                        <tr>
                                            <td><code>options</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-warning text-dark">否</span></td>
                                            <td>选项内容，通常是A、B、C、D选项的文本</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-header bg-success bg-opacity-10 text-success">
                                    <h5 class="mb-0 fs-6"><i class="bi bi-check-circle me-2"></i>成功响应</h5>
                                </div>
                                <div class="card-body">
                                    <pre class="mb-0"><code>{
  "code": 1,
  "question": "问题内容",
  "answer": "AI生成的答案"
}</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-header bg-danger bg-opacity-10 text-danger">
                                    <h5 class="mb-0 fs-6"><i class="bi bi-exclamation-circle me-2"></i>失败响应</h5>
                                </div>
                                <div class="card-body">
                                    <pre class="mb-0"><code>{
  "code": 0,
  "msg": "错误信息"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="api-example mt-4">
                        <h5 class="fs-6"><i class="bi bi-code-slash me-2"></i>请求示例</h5>
                        <div class="card border-0 shadow-sm">
                            <div class="card-body bg-light">
                                <pre class="mb-0"><code>// POST /api/search
// Content-Type: application/json

{
  "title": "下列哪个是中国的首都?",
  "type": "single",
  "options": "A. 上海\nB. 北京\nC. 广州\nD. 深圳"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 题库管理接口 -->
            <div id="qa-management" class="api-section tab-pane fade" role="tabpanel" aria-labelledby="qa-tab">
                <h3><i class="bi bi-database me-2"></i>题库管理接口</h3>
                
                <div class="api-item p-3 mb-4 border-start border-success border-3 rounded-3 bg-light">
                    <h4 class="d-flex align-items-center">
                        <i class="bi bi-plus-circle me-2 text-success"></i>手动添加题目
                        <span class="ms-auto badge bg-success rounded-pill">数据管理</span>
                    </h4>
                    
                    <div class="endpoint">
                        <span class="method method-post">POST</span>
                        <strong>/api/record/add</strong>
                    </div>
                    
                    <div class="api-description mb-3">
                        <p><i class="bi bi-info-circle me-2"></i>手动录入题目到数据库和缓存。该接口可用于批量导入题库数据。</p>
                    </div>
                    
                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0 fs-6"><i class="bi bi-list-ul me-2"></i>请求参数</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <th>参数名</th>
                                            <th>类型</th>
                                            <th>必填</th>
                                            <th>说明</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>question</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-success">是</span></td>
                                            <td>题目内容</td>
                                        </tr>
                                        <tr>
                                            <td><code>type</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-success">是</span></td>
                                            <td>题目类型 (single-单选, multiple-多选, judgement-判断, completion-填空)</td>
                                        </tr>
                                        <tr>
                                            <td><code>options</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-warning text-dark">否</span></td>
                                            <td>选项内容，通常是A、B、C、D选项的文本</td>
                                        </tr>
                                        <tr>
                                            <td><code>answer</code></td>
                                            <td><span class="badge bg-secondary">string</span></td>
                                            <td><span class="badge bg-success">是</span></td>
                                            <td>题目答案</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-4 border-0 shadow-sm">
                        <div class="card-header bg-success bg-opacity-10 text-success">
                            <h5 class="mb-0 fs-6"><i class="bi bi-check-circle me-2"></i>响应格式</h5>
                        </div>
                        <div class="card-body">
                            <pre class="mb-0"><code>{
  "success": true,
  "message": "已新增"
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="api-example mt-4">
                        <h5 class="fs-6"><i class="bi bi-code-slash me-2"></i>请求示例</h5>
                        <div class="card border-0 shadow-sm">
                            <div class="card-body bg-light">
                                <pre class="mb-0"><code>// POST /api/record/add
// Content-Type: application/json
// X-Access-Token: your_token_here (如配置了访问令牌)

{
  "question": "下列哪个是中国的首都?",
  "type": "single",
  "options": "A. 上海\nB. 北京\nC. 广州\nD. 深圳",
  "answer": "B"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <h4>更新题目记录</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/record/update</strong>
                </div>
                
                <p>更新已有的问答记录。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>record_id</td>
                            <td>integer</td>
                            <td>是</td>
                            <td>记录ID</td>
                        </tr>
                        <tr>
                            <td>question</td>
                            <td>string</td>
                            <td>否</td>
                            <td>题目内容</td>
                        </tr>
                        <tr>
                            <td>type</td>
                            <td>string</td>
                            <td>否</td>
                            <td>题目类型</td>
                        </tr>
                        <tr>
                            <td>options</td>
                            <td>string</td>
                            <td>否</td>
                            <td>选项内容</td>
                        </tr>
                        <tr>
                            <td>answer</td>
                            <td>string</td>
                            <td>否</td>
                            <td>题目答案</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "记录已更新"
}</code></pre>

                <h4>删除题目记录</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/record/delete</strong>
                </div>
                
                <p>删除指定的问答记录。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>record_id</td>
                            <td>integer</td>
                            <td>是</td>
                            <td>记录ID</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "记录已删除"
}</code></pre>

                <h4>题库数据导出</h4>
                <div class="endpoint">
                    <span class="method method-get">GET</span>
                    <strong>/api/questions/export</strong>
                </div>
                
                <p>将题库数据导出为CSV文件。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>type</td>
                            <td>string</td>
                            <td>否</td>
                            <td>题目类型筛选</td>
                        </tr>
                        <tr>
                            <td>q</td>
                            <td>string</td>
                            <td>否</td>
                            <td>搜索关键词</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <p>返回CSV文件下载。</p>

                <h4>题库数据导入</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/questions/import</strong>
                </div>
                
                <p>从CSV文件导入题库数据。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>file</td>
                            <td>file</td>
                            <td>是</td>
                            <td>CSV格式的题库文件</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "成功导入10条记录，失败0条"
}</code></pre>

                <h4>题目批量删除</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/questions/batch-delete</strong>
                </div>
                
                <p>批量删除多条题库记录。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>record_ids</td>
                            <td>array</td>
                            <td>是</td>
                            <td>记录ID数组</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "成功删除5条记录"
}</code></pre>
            </div>

            <!-- 系统功能接口 -->
            <div id="system-api" class="mb-5">
                <h3 class="border-bottom pb-2">系统功能接口</h3>
                
                <h4>健康检查接口</h4>
            <div class="endpoint">
                <span class="method method-get">GET</span>
                <strong>/api/health</strong>
            </div>
            
            <p>用于检查服务运行状态。</p>
            
                <h5>响应:</h5>
            <pre><code>{
  "status": "ok",
  "message": "AI题库服务运行正常",
  "version": "1.0.0",
  "cache_enabled": true,
  "model": "gpt-3.5-turbo"
}</code></pre>

                <h4>缓存清理接口</h4>
            <div class="endpoint">
                <span class="method method-post">POST</span>
                <strong>/api/cache/clear</strong>
            </div>
            
            <p>用于清理服务缓存的答案。</p>
            
                <h5>响应:</h5>
            <pre><code>{
  "success": true,
  "message": "缓存已清除，共123条记录"
}</code></pre>
            </div>
            
            <!-- Token管理接口 -->
            <div id="token-api" class="mb-5">
                <h3 class="border-bottom pb-2">Token管理接口</h3>
                
                <h4>获取Token列表</h4>
                <div class="endpoint">
                    <span class="method method-get">GET</span>
                    <strong>/api/tokens</strong>
                </div>
                
                <p>获取所有可用的API令牌。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>p</td>
                            <td>integer</td>
                            <td>否</td>
                            <td>页码，默认为0</td>
                        </tr>
                        <tr>
                            <td>size</td>
                            <td>integer</td>
                            <td>否</td>
                            <td>每页记录数，默认为10</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "",
  "data": [
    {
      "id": 344,
      "user_id": 84,
      "key": "TvSL6MICe45rY67o3GxtFgquKwx948T2cv7uEkSxEcMBDTw8",
      "status": 1,
      "name": "-WRvw41",
      "created_time": 1748229740,
      "accessed_time": 1748273952,
      "expired_time": 1750821712,
      "remain_quota": 492934,
      "unlimited_quota": false,
      "model_limits_enabled": true,
      "model_limits": "gpt-4o",
      "allow_ips": "",
      "used_quota": 7066,
      "group": "",
      "DeletedAt": null
    }
  ]
}</code></pre>

                <h4>创建新Token</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/tokens</strong>
                </div>
                
                <p>创建新的API令牌。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>name</td>
                            <td>string</td>
                            <td>否</td>
                            <td>令牌名称</td>
                        </tr>
                        <tr>
                            <td>expired_days</td>
                            <td>integer</td>
                            <td>否</td>
                            <td>有效期(天)，0表示永不过期</td>
                        </tr>
                        <tr>
                            <td>quota</td>
                            <td>integer</td>
                            <td>否</td>
                            <td>配额限制</td>
                        </tr>
                        <tr>
                            <td>unlimited</td>
                            <td>boolean</td>
                            <td>否</td>
                            <td>是否无限配额</td>
                        </tr>
                        <tr>
                            <td>model_limits</td>
                            <td>string</td>
                            <td>否</td>
                            <td>模型限制</td>
                        </tr>
                        <tr>
                            <td>model_limits_enabled</td>
                            <td>boolean</td>
                            <td>否</td>
                            <td>是否启用模型限制</td>
                        </tr>
                        <tr>
                            <td>allow_ips</td>
                            <td>string</td>
                            <td>否</td>
                            <td>允许的IP地址，多个IP用逗号分隔</td>
                        </tr>
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "令牌创建成功",
  "data": {
    "id": 345,
    "key": "NEW_TOKEN_KEY_1234567890",
    "status": 1,
    "name": "新令牌"
    // 其他令牌信息...
  }
}</code></pre>

                <h4>更新Token</h4>
                <div class="endpoint">
                    <span class="method method-put">PUT</span>
                    <strong>/api/tokens/{token_id}</strong>
                </div>
                
                <p>更新已有的API令牌。</p>
                
                <h5>参数:</h5>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>参数名</th>
                            <th>类型</th>
                            <th>必填</th>
                            <th>说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>id</td>
                            <td>integer</td>
                            <td>是</td>
                            <td>令牌ID</td>
                        </tr>
                        <tr>
                            <td>name</td>
                            <td>string</td>
                            <td>否</td>
                            <td>令牌名称</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>integer</td>
                            <td>否</td>
                            <td>状态(1-启用, 0-禁用)</td>
                        </tr>
                        <!-- 其他可更新的参数与创建接口相同 -->
                    </tbody>
                </table>

                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "令牌更新成功",
  "data": {
    // 更新后的令牌信息
  }
}</code></pre>

                <h4>删除Token</h4>
                <div class="endpoint">
                    <span class="method method-delete">DELETE</span>
                    <strong>/api/tokens/{token_id}</strong>
                </div>
                
                <p>删除指定的API令牌。</p>
                
                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "令牌已删除"
}</code></pre>

                <h4>强制切换密钥</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/key_switch</strong>
                </div>
                
                <p>强制切换当前使用的API密钥。</p>
                
                <h5>响应:</h5>
            <pre><code>{
  "success": true,
  "data": {
    "old_key": "sk-abcdefghijklmn...",
    "current_key": "sk-opqrstuvwxyz..."
  },
  "message": "密钥切换成功"
}</code></pre>

                <h4>清除Token缓存</h4>
                <div class="endpoint">
                    <span class="method method-post">POST</span>
                    <strong>/api/clear_token_cache</strong>
                </div>
                
                <p>清除Token详情缓存。</p>
                
                <h5>响应:</h5>
                <pre><code>{
  "success": true,
  "message": "缓存已清除"
}</code></pre>
            </div>

            <h2>OCS配置示例</h2>
            <p>在OCS的自定义题库配置中添加如下配置:</p>
            
            <pre><code>[
  {
    "name": "EduBrain AI智能题库",
    "homepage": "https://github.com/yourusername/edubrain-ai",
    "url": "http://localhost:5000/api/search",
    "method": "get",
    "contentType": "json",
    "data": {
      "title": "${title}",
      "type": "${type}",
      "options": "${options}"
    },
    "handler": "return (res)=> res.code === 1 ? [res.question, res.answer] : [res.msg, undefined]"
  }
]</code></pre>

            <h2>安全设置</h2>
            <p>如果你想增加安全性，可以在<code>config.json</code>文件中设置访问令牌:</p>
            
            <pre><code>{
  "security": {
    "access_token": "your_secret_token_here"
  }
}</code></pre>

            <p>设置后，所有API请求都需要包含此令牌，可以通过以下两种方式之一传递:</p>
            <ol>
                <li>HTTP头部: <code>X-Access-Token: your_secret_token_here</code></li>
                <li>URL参数: <code>?token=your_secret_token_here</code></li>
            </ol>

            <h2>注意事项</h2>
            <ol>
                <li><strong>多选题答案格式</strong>: 对于多选题，OCS期望的答案格式是用<code>#</code>分隔的选项，例如<code>A#B#C</code>。本服务会自动处理这个格式，将OpenAI返回的多选答案转换为此格式。</li>
                <li><strong>API请求限制</strong>: 注意OpenAI API有使用限制和费用。确保你的账户有足够的额度来处理预期的请求量。</li>
                <li><strong>网络连接</strong>: 确保部署此服务的服务器能够访问OpenAI API（api.openai.com）。某些地区可能需要代理服务。</li>
                <li><strong>题库域名</strong>: 根据OCS文档说明，需要将题库配置中<code>homepage</code>以及<code>url</code>所涉及到的域名，在脚本头部元信息<code>@connect</code>中新增，否则无法请求到数据。</li>
            </ol>
        </div>
    </div>
</div>
<!-- 滚动到顶部按钮 -->
<div class="scroll-top" id="scrollTopBtn">
    <i class="bi bi-arrow-up"></i>
</div>

<footer class="footer mt-5 py-4 bg-dark text-white">
    <div class="container">
        <div class="row">
            <div class="col-md-6 mb-3 mb-md-0">
                <h5 class="mb-3"><i class="bi bi-book me-2"></i>EduBrain AI</h5>
                <p class="text-muted">专为在线教育平台提供智能题库解决方案，提升学习效率。</p>
            </div>
            <div class="col-md-3 mb-3 mb-md-0">
                <h6 class="mb-3">相关资源</h6>
                <ul class="list-unstyled">
                    <li class="mb-2"><a href="https://github.com/ocsjs/ocsjs" target="_blank" class="text-decoration-none text-muted"><i class="bi bi-github me-2"></i>OCS 项目</a></li>
                    <li class="mb-2"><a href="/dashboard" class="text-decoration-none text-muted"><i class="bi bi-speedometer2 me-2"></i>控制面板</a></li>
                    <li class="mb-2"><a href="/ai_search" class="text-decoration-none text-muted"><i class="bi bi-search me-2"></i>AI 搜题</a></li>
                </ul>
            </div>
            <div class="col-md-3">
                <h6 class="mb-3">技术支持</h6>
                <ul class="list-unstyled">
                    <li class="mb-2"><a href="/settings" class="text-decoration-none text-muted"><i class="bi bi-gear me-2"></i>系统设置</a></li>
                    <li class="mb-2"><a href="/questions" class="text-decoration-none text-muted"><i class="bi bi-database me-2"></i>题库管理</a></li>
                    <li class="mb-2"><a href="/logs" class="text-decoration-none text-muted"><i class="bi bi-journal-text me-2"></i>系统日志</a></li>
                </ul>
            </div>
        </div>
        <hr class="my-3 bg-secondary">
        <div class="text-center text-muted">
            <small>Copyright &copy; {{ current_year }} EduBrain AI. All rights reserved.</small>
        </div>
    </div>
</footer>

<script>
    // 初始化标签页切换和交互功能
    document.addEventListener('DOMContentLoaded', function() {
        // 初始化Bootstrap标签页
        const tabLinks = document.querySelectorAll('#apiTabs .nav-link');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // 移除所有标签的活动状态
                tabLinks.forEach(l => l.classList.remove('active'));
                tabPanes.forEach(p => {
                    p.classList.remove('show');
                    p.classList.remove('active');
                });
                
                // 激活当前标签
                this.classList.add('active');
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.classList.add('show');
                    target.classList.add('active');
                }
                
                // 更新URL的hash
                history.pushState(null, null, this.getAttribute('href'));
            });
        });
        
        // 如果有URL hash，自动打开相应标签
        if (window.location.hash) {
            const hash = window.location.hash;
            const tab = document.querySelector(`a[href="${hash}"]`);
            if (tab) tab.click();
        }
        
        // 滚动到顶部按钮
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        
        // 滚动时显示/隐藏按钮
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollTopBtn.classList.add('show');
            } else {
                scrollTopBtn.classList.remove('show');
            }
        });
        
        // 点击滚动到顶部
        scrollTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // 代码高亮效果
        document.querySelectorAll('pre code').forEach(block => {
            // 添加类似语法高亮的效果
            const lines = block.innerHTML.split('\n');
            let highlighted = '';
            
            lines.forEach(line => {
                // 高亮关键字
                let coloredLine = line
                    .replace(/(\/\/.*)/g, '<span style="color: #6c757d;">$1</span>') // 注释
                    .replace(/(".*?")/g, '<span style="color: #28a745;">$1</span>') // 字符串
                    .replace(/\b(POST|GET|DELETE|PUT)\b/g, '<span style="color: #dc3545; font-weight: bold;">$1</span>') // HTTP方法
                    .replace(/\b(true|false|null)\b/g, '<span style="color: #fd7e14; font-weight: bold;">$1</span>'); // 布尔值
                
                highlighted += coloredLine + '\n';
            });
            
            block.innerHTML = highlighted;
        });
        
        // 添加复制代码功能
        document.querySelectorAll('.card-body pre').forEach(block => {
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn btn btn-sm btn-light position-absolute top-0 end-0 m-2';
            copyBtn.innerHTML = '<i class="bi bi-clipboard"></i>';
            copyBtn.title = '复制代码';
            
            // 设置父元素为相对定位
            block.parentNode.style.position = 'relative';
            
            copyBtn.addEventListener('click', function() {
                const code = block.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    copyBtn.innerHTML = '<i class="bi bi-check"></i>';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="bi bi-clipboard"></i>';
                    }, 2000);
                });
            });
            
            block.parentNode.appendChild(copyBtn);
        });
    });
</script>
{% endblock %} 