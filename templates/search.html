{% extends 'base.html' %}
{% block title %}EduBrain AI - 题目搜索{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="search-container">
        <h1 class="text-center mb-4">题目搜索</h1>
        
        <div class="card mb-4">
            <div class="card-body">
                <form id="searchForm" action="{{ url_for('search_page') }}" method="GET">
                    <div class="mb-3">
                        <label for="searchQuery" class="form-label">搜索关键词</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchQuery" name="q" placeholder="输入题目关键词..." value="{{ search_query }}">
                            <button class="btn btn-primary" type="submit">搜索</button>
                        </div>
                    </div>
                    
                    <div class="mb-3 type-filter">
                        <label class="form-label">题目类型</label>
                        <div>
                            <a href="{{ url_for('search_page', q=search_query) }}" class="btn btn-sm {% if not current_type %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                所有类型
                            </a>
                            <a href="{{ url_for('search_page', q=search_query, type='single') }}" class="btn btn-sm {% if current_type == 'single' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                单选题
                            </a>
                            <a href="{{ url_for('search_page', q=search_query, type='multiple') }}" class="btn btn-sm {% if current_type == 'multiple' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                多选题
                            </a>
                            <a href="{{ url_for('search_page', q=search_query, type='judgement') }}" class="btn btn-sm {% if current_type == 'judgement' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                判断题
                            </a>
                            <a href="{{ url_for('search_page', q=search_query, type='completion') }}" class="btn btn-sm {% if current_type == 'completion' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                填空题
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {% if search_query %}
            <div class="mb-3">
                <h5>找到 {{ records|length }} 条结果</h5>
            </div>
            
            {% if records %}
                {% for record in records %}
                    <div class="search-result">
                        <div class="d-flex justify-content-between align-items-start">
                            <h5>{{ record.question }}</h5>
                            {% if record.type == 'single' %}
                                <span class="badge bg-success">单选题</span>
                            {% elif record.type == 'multiple' %}
                                <span class="badge bg-primary">多选题</span>
                            {% elif record.type == 'judgement' %}
                                <span class="badge bg-warning">判断题</span>
                            {% elif record.type == 'completion' %}
                                <span class="badge bg-info">填空题</span>
                            {% else %}
                                <span class="badge bg-secondary">未知类型</span>
                            {% endif %}
                        </div>
                        
                        {% if record.options %}
                            <div class="options mb-3">
                                <p class="mb-1"><strong>选项:</strong></p>
                                <p>{{ record.options }}</p>
                            </div>
                        {% endif %}
                        
                        <div class="answer">
                            <p class="mb-1"><strong>答案:</strong></p>
                            <p class="mb-0">{{ record.answer }}</p>
                        </div>
                    </div>
                {% endfor %}
                
                <!-- 分页 -->
                {% if total_pages > 1 %}
                <nav aria-label="分页导航">
                    <ul class="pagination justify-content-center">
                        <li class="page-item {% if page == 1 %}disabled{% endif %}">
                            <a class="page-link" href="{{ url_for('search_page', page=page-1, q=search_query, type=current_type) }}">上一页</a>
                        </li>
                        
                        {% for p in range(1, total_pages + 1) %}
                            {% if p == page %}
                                <li class="page-item active">
                                    <span class="page-link">{{ p }}</span>
                                </li>
                            {% elif p >= page - 2 and p <= page + 2 %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('search_page', page=p, q=search_query, type=current_type) }}">{{ p }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                        
                        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                            <a class="page-link" href="{{ url_for('search_page', page=page+1, q=search_query, type=current_type) }}">下一页</a>
                        </li>
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <div class="alert alert-info">
                    没有找到匹配的题目，请尝试其他关键词。
                </div>
            {% endif %}
        {% else %}
            <div class="text-center py-5">
                <i class="bi bi-search" style="font-size: 4rem; color: #e9ecef;"></i>
                <p class="mt-3 text-muted">输入关键词开始搜索题目</p>
            </div>
        {% endif %}
    </div>
</div>
<footer class="footer mt-5 py-3 bg-light">
    <div class="container text-center">
        <p class="text-muted">Copyright &copy; {{ current_year }} EduBrain AI. All rights reserved.</p>
    </div>
</footer>
{% endblock %} 